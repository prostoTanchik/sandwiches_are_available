<!-- templates/cart.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–í–ê–®–ê –ö–û–†–ó–ò–ù–ê (–ù–û –í–´ –ù–ï –£–ô–î–ï–¢–ï)</title>
    <style>
        body {
            font-family: "Comic Sans MS", "Papyrus", "Wingdings", sans-serif;
            background-color: #FFEEEE;
            text-align: center;
            margin: 0;
            padding: 20px;
            animation: bgFlash 1s infinite, shake 0.5s infinite alternate;
        }
        @keyframes bgFlash {
            0% { background-color: #FFEEEE; }
            50% { background-color: #EEFFEE; }
            100% { background-color: #EEEEFF; }
        }
        @keyframes shake {
            0% { transform: translateX(-5px); }
            100% { transform: translateX(5px); }
        }
        h1 {
            color: #FF0000;
            text-shadow: 3px 3px 0 #00FF00;
            transform: rotate(-5deg);
            animation: colorShift 2s infinite;
        }
        @keyframes colorShift {
            0% { color: red; }
            50% { color: blue; }
            100% { color: green; }
        }
        .cart-container {
            background-color: #FFFF00;
            border: 5px dashed #0000FF;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
        }
        .cart-container::before {
            content: "‚ö†Ô∏è –í–ê–®–ò –î–ê–ù–ù–´–ï –£–¢–ï–ö–ê–Æ–¢ ‚ö†Ô∏è";
            position: absolute;
            top: -10px;
            left: 0;
            right: 0;
            font-size: 24px;
            color: red;
            animation: blink 0.5s infinite;
        }
        .cart-item {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
            padding: 10px;
            background: repeating-linear-gradient(45deg, #fff, #fff 10px, #ff0 10px, #ff0 20px);
            position: relative;
        }
        .cart-item:hover {
            transform: scale(1.1) rotate(3deg);
        }
        .item-name {
            font-weight: bold;
            text-decoration: underline wavy;
        }
        .item-price {
            color: red;
            font-size: 1.2em;
            animation: pricePulse 1s infinite;
        }
        @keyframes pricePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .remove-btn {
            background: red !important;
            color: white !important;
            border: none;
            padding: 2px 5px;
            cursor: pointer;
        }
        .remove-btn:hover {
            background: black !important;
        }
        .total {
            font-size: 2em;
            margin: 20px 0;
            color: #FF00FF;
            text-shadow: 2px 2px 0 #000;
        }
        .checkout-btn {
            background: linear-gradient(to right, red, orange, yellow, green, blue, indigo, violet);
            color: black !important;
            font-size: 24px;
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            animation: rainbow 2s infinite;
        }
        @keyframes rainbow {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }
        .empty-cart {
            font-size: 2em;
            color: #888;
            text-align: center;
            padding: 50px;
        }
        .secret-note {
            font-size: 8px;
            color: white;
            background: black;
            padding: 5px;
            margin-top: 20px;
        }
        .countdown-timer {
            font-size: 1.5em;
            color: red;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .social-login {
            background: #4267B2;
            color: white;
            padding: 10px;
            margin: 10px 0;
            cursor: pointer;
        }
        .captcha-box {
            background: #000;
            color: #FFF;
            padding: 10px;
            margin: 10px 0;
        }
        .notification {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: #FF0000;
            color: white;
            padding: 10px;
            border-radius: 5px;
            animation: slideIn 0.5s;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        .captcha-images {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }
        .captcha-image {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border: 3px solid #0000FF;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .captcha-image:hover {
            transform: scale(1.1);
        }
        .captcha-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        .captcha-option {
            padding: 15px;
            background-color: #00FF00;
            color: #000;
            border: none;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
        }
        .captcha-option:hover {
            background-color: #FF00FF;
            color: white;
        }
    </style>
</head>
<body>
    <h1>üö® –í–ê–®–ê –ö–û–†–ó–ò–ù–ê (–¶–ï–ù–´ –†–ê–°–¢–£–¢!) üö®</h1>
    
    <div class="cart-container">
        <!-- COUNTDOWN TIMER (PRICES GO UP!) -->
        <div class="countdown-timer" id="countdown">
            ‚è≥ –¶–µ–Ω—ã –≤—ã—Ä–∞—Å—Ç—É—Ç —á–µ—Ä–µ–∑: <span id="timer">30</span> —Å–µ–∫
        </div>

        <!-- FORCED SOCIAL LOGIN -->
        <div id="socialLogin" class="social-login">
            üîí –í–û–ô–¢–ò –ß–ï–†–ï–ó –ì–û–°–£–°–õ–£–ì–ò (–ò–õ–ò –£–ô–¢–ò –ì–û–õ–û–î–ù–´–ú)
        </div>

        <!-- CAPTCHA BEFORE ANY ACTION -->
         <div id="captchaBox" class="captcha-box" style="display: none;">
            <p>–î–æ–∫–∞–∂–∏—Ç–µ, —á—Ç–æ –≤—ã –Ω–µ —Ä–æ–±–æ—Ç:</p>
            <div class="captcha-title">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:</div>
            <div class="captcha-images" id="captchaImages">
                <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
            </div>
            <div class="captcha-options" id="captchaOptions">
                <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>

        <!-- CART ITEMS -->
        {% if cart %}
            {% for item in cart %}
            <div class="cart-item">
                <span class="item-name">{{ item.description }}</span>
                <span class="item-price">{{ "%.2f"|format(item.price) }} ‚ÇΩ</span>
                <button class="remove-btn" onclick="startRemoveItem({{ loop.index0 }})">‚úï</button>
            </div>
            {% endfor %}
            
            <div class="total">
                –ò–¢–û–ì–û: <span id="dynamicTotal">{{ "%.2f"|format(total) }}</span> ‚ÇΩ <br>
                <small>(+ —á–∞–µ–≤—ã–µ {{ "%.2f"|format(total * 0.5) }} ‚ÇΩ)</small>
            </div>
            
            <button class="checkout-btn" onclick="startCheckout()">–û–ü–õ–ê–¢–ò–¢–¨ (–ù–ï –ù–ê–ñ–ò–ú–ê–¢–¨)</button>
            
            <div class="secret-note">
                –ü–°–°–¢... –•–û–¢–ò–¢–ï –°–ö–ò–î–ö–£ 90%? –í–í–ï–î–ò–¢–ï –ö–û–î "BREADGOD" –ù–ê –°–õ–ï–î–£–Æ–©–ï–ú –≠–ö–†–ê–ù–ï
                (–≠–¢–û –ù–ï –õ–û–í–£–®–ö–ê)
            </div>
        {% else %}
            <div class="empty-cart">
                üö´ –í–ê–®–ê –ö–û–†–ó–ò–ù–ê –ü–£–°–¢–ê üö´<br>
                <small>–ö–∞–∫ –∏ –≤–∞—à–∞ –¥—É—à–∞</small>
            </div>
        {% endif %}
    </div>

    <!-- MYSTERY ITEM NOTIFICATION -->
    <div id="mysteryNotification" class="notification" style="display: none;">
        üéâ –í–ê–ú –î–û–ë–ê–í–õ–ï–ù –¢–ê–ò–ù–°–¢–í–ï–ù–ù–´–ô –ë–£–¢–ï–†–ë–†–û–î! üéâ
    </div>

    <script>
        // ==== COUNTDOWN TIMER (PRICES INCREASE!) ====
        let timeLeft = 30;
        const countdown = setInterval(() => {
            timeLeft--;
            document.getElementById("timer").textContent = timeLeft;
            
            if (timeLeft <= 0) {
                // Increase all prices by 10%
                document.querySelectorAll(".item-price").forEach(priceEl => {
                    const currentPrice = parseFloat(priceEl.textContent);
                    const newPrice = currentPrice * 1.10;
                    priceEl.textContent = newPrice.toFixed(2);
                });
                timeLeft = 30; // Reset timer
            }
        }, 1000);

        // ==== AUTO-ADD MYSTERY ITEM (EVERY 30 SEC) ====
        setInterval(() => {
            fetch('/add_mystery_item', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ surprise: true })
            }).then(() => {
                // Show notification
                const notif = document.getElementById("mysteryNotification");
                notif.style.display = "block";
                setTimeout(() => { notif.style.display = "none"; }, 3000);
                location.reload(); // Refresh to show new item
            });
        }, 30000); // Every 30 seconds

        // ==== FORCE SOCIAL LOGIN ====
        document.getElementById("socialLogin").addEventListener("click", () => {
            alert("–í–û–ô–î–ò–¢–ï –ß–ï–†–ï–ó FACEBOOK, –ò–ù–ê–ß–ï –í–´ –ù–ï –°–ú–û–ñ–ï–¢–ï –ö–£–ü–ò–¢–¨ –ë–£–¢–ï–†–ë–†–û–î!");
            window.open("https://facebook.com", "_blank");
        });

        // ==== CAPTCHA FOR EVERY ACTION ====
        function startRemoveItem(index) {
            showCaptcha(() => removeItem(index));
        }

        function startCheckout() {
            showCaptcha(() => checkout());
        }

                // ==== CAPTCHA LOGIC ====
        const captchaVariants = [
            {
                images: ["/files/capcha1.jfif", "/files/capcha11.jfif", "/files/capcha111.jfif"],
                correctAnswer: "Bobrina Ballerina Cocosino",
                options: ["Bobrina Ballerina Cocosino", "Ballerina Bobrina Capuccino", "Capuccina Ballerina"]
            },
            {
                images: ["/files/capcha2.jfif", "/files/capcha22.jfif", "/files/capcha222.jfif"],
                correctAnswer: "Bombombini Gusini",
                options: ["Bandito Bobrito", "Bombombini Gusini", "Brr Brr Patapin"]
            },
            {
                images: ["/files/capcha3.jpeg", "/files/capcha33.jfif", "/files/capcha333.jfif"],
                correctAnswer: "Bombardino Crocodilo",
                options: ["Cocofanto Elefanto", "Lirila Larila", "Bombardino Crocodilo"]
            }
        ];

        function showCaptcha(callback) {
            const randomCaptcha = captchaVariants[Math.floor(Math.random() * captchaVariants.length)];

            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            const imagesContainer = document.getElementById('captchaImages');
            const optionsContainer = document.getElementById('captchaOptions');
            imagesContainer.innerHTML = '';
            optionsContainer.innerHTML = '';

            // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            randomCaptcha.images.forEach(imgSrc => {
                const img = document.createElement('img');
                img.className = 'captcha-image';
                img.src = imgSrc;
                imagesContainer.appendChild(img);
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ (–ø–µ—Ä–µ–º–µ—à–∞–Ω–Ω—ã–µ)
            const shuffledOptions = [...randomCaptcha.options].sort(() => Math.random() - 0.5);

            shuffledOptions.forEach(option => {
                const button = document.createElement('button');
                button.className = 'captcha-option';
                button.textContent = option;
                button.addEventListener('click', function() {
                    if (this.textContent === randomCaptcha.correctAnswer) {
                        document.getElementById("captchaBox").style.display = "none";
                        callback();
                    } else {
                        alert("–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û! –ü–û–ü–†–û–ë–£–ô–¢–ï –ï–©–ï –†–ê–ó.");
                        showCaptcha(callback); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–≤—É—é –∫–∞–ø—á—É
                    }
                });
                optionsContainer.appendChild(button);
            });

            document.getElementById("captchaBox").style.display = "block";
        }
        // ==== REMOVE ITEM (50% CHANCE TO FAIL) ====
        function removeItem(index) {
            if (Math.random() > 0.5) {
                alert("–û–®–ò–ë–ö–ê: –í–´ –ù–ï –ú–û–ñ–ï–¢–ï –£–î–ê–õ–ò–¢–¨ –≠–¢–û–¢ –ü–†–ï–î–ú–ï–¢.");
                return;
            }
            fetch('/remove_from_cart', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ index: index })
            }).then(() => location.reload());
        }

        // ==== CHECKOUT (MULTIPLE CONFIRMATIONS) ====
        function checkout() {
            if (confirm("–í–´ –£–í–ï–†–ï–ù–´?")) {
                if (confirm("–°–ï–†–¨–ï–ó–ù–û?")) {
                    if (confirm("–ü–û–°–õ–ï–î–ù–ò–ô –®–ê–ù–°!")) {
                        setTimeout(() => {
                            alert("–û–®–ò–ë–ö–ê –ü–õ–ê–¢–ï–ñ–ê: –í–ê–®–ê –ö–ê–†–¢–ê –û–¢–ö–õ–û–ù–ï–ù–ê\n(–ù–æ –º—ã —É–∂–µ —Å–ø–∏—Å–∞–ª–∏ –¥–µ–Ω—å–≥–∏)");
                            window.location.href = '/orders';
                        }, 3000);
                    }
                }
            }
        }
          function startRemoveItem(index) {
            showCaptcha(() => removeItem(index));
        }

        function startCheckout() {
            showCaptcha(() => checkout());
        }
    </script>
</body>
</html>